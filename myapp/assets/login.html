<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <script>

        var fingerPrintKey = "fingerprint";
        // The container fires the "deviceready" Event, as soon as the interfaces are in place and the Login page was loaded.
        // Calls on the interfaces made available by the container should happen only after this event, for example in the event handler for the // "deviceready" event.
        window.document.addEventListener("deviceready", function () {
            console.log('*** deviceready');
            init();
        }, false);

        function init() {
            console.log('*** init');
            window.plugins.fingerprint.isAvailable(function () {

                window.plugins.fingerprint.has(fingerPrintKey, function () {
                    window.plugins.fingerprint.verify(fingerPrintKey, "Legen Sie ihren Finger auf, um sich einzuloggen."
                        , function (data) {
                            if (data) {
                                fillOutLoginForm(data);
                            }
                            toggleChangeUserContextButton(!!data);
                        }
                        , function (error) { });

                }, function () {
                    window.document.getElementById("saveFingerprint").style.display = "";
                });
            });
        }

        // Validate the data in the login form: if both username and password were provided, the login button will be activated
        function validateLoginForm() {
            window.document.getElementById("loginButton").disabled = !window.document.loginForm.userName.value ||
                !window.document.loginForm.userPassword.value;
        }

        function fillOutLoginForm(data) {
            if (data) {
                if (data.hasOwnProperty("userName")) {

                    window.document.loginForm.userName.value = data.userName;
                }
                if (data.hasOwnProperty("userPassword")) {
                    window.document.loginForm.userPassword.value = data.userPassword;
                }
                // Checks the login form and on success it activates the login button
                validateLoginForm();
            }
        }

        function toggleChangeUserContextButton(visible) {
            // Show or hide the button for saving the previously saved username and password 
            window.document.getElementById("changeUserContextButton").style.display = visible ? "" : "none";
        }


        // This method deletes the saved username from the LocalStorage.
        // It additionally deletes the password from both the fingerprint and LocalStorage (if there is one saved there). 
        function deleteCurrentSavedUserContext() {
            // Checks if fingerprint functionality is available 
            window.plugins.fingerprint.isAvailable(function () {
                // Fingerprint functionality is available
                // Delete the previously saved password from fingerprint
                // functionality 
                window.plugins.fingerprint.delete(fingerPrintKey, function () {
                    // Delete was successful
                    // Hide the button to delete previously saved data 
                    toggleChangeUserContextButton(false);
                    window.document.getElementById("saveFingerprint").style.display = "";
                    // Removes all data from the login form
                    fillOutLoginForm({
                        userName: null,
                        userPassword: null
                    });
                }, function () {
                    // Delete failed
                });
            }, function () {
                // Fingerprint functionality is not available
            });

        }

        // This methods starts the login process in Frontend
        function startLogin() {
            if (window.document.loginForm.saveData.checked) { // User data must be saved
                var data = {
                    "userName": window.document.loginForm.userName.value,
                    "userPassword": window.document.loginForm.userPassword.value
                };
                window.plugins.fingerprint.save(fingerPrintKey, JSON.stringify(data), function () {
                    // Submit the login form and proceed with the login process on your backend 
                    window.document.loginForm.submit();
                }, function () {
                    // user has canceled
                    // Submit the login form and proceed with the login process on your backend 
                    window.document.loginForm.submit();
                });
            } else {
                // Submit the login form and proceed with the login process on your backend 
                window.document.loginForm.submit();
            }
        }


    </script>
</head>

<body style="background-color: #FFF;">


    <div style="text-align: center; font-weight: bold; font-size: 200%;">Login</div>

    <div style="text-align: center;">Bitte geben Sie Ihre Logindaten ein</div>

    <!-- https://cfd2.staging.sgmarkets.com/fortune-web-server/static/fortune-mobile/authenticationServlet -->
    <!-- https://pantpreap202de.de.world.socgen:8457/fortune-web-server/static/fortune-mobile/authenticationServlet -->
    <form method="POST" name="loginForm"
        action="https://cfd2.staging.sgmarkets.com/fortune-web-server/static/fortune-mobile/authenticationServlet">

        <input type="hidden" name="userType" value="CUSTOMER" />

        <input type="hidden" name="reloginUrl" value="" />

        <input type="hidden" name="ploc" value="true" />

        <input type="hidden" name="locale" value="en" />


        <table width="60%" align="center"
            style="border: 2px solid #000000; font-size: 10pt; background-color: #F4F4F4;">

            <tbody>
                <tr>
                    <td><label for="intermediaryCode" style="font-weight: bold;">intermediaryCode</label></td>
                    <td><input id="intermediaryCode" type="text" name="intermediaryCode" value="COMDIRECT" /></td>
                </tr>
                <tr>
                    <td><label for="userName" style="font-weight: bold;">tradingAccountNumber</label></td>
                    <td><input id="tradingAccountNumber" type="text" name="tradingAccountNumber" value="102100060371" />
                    </td>
                </tr>
                <tr>
                    <td><label for="userName" style="font-weight: bold;">Username</label></td>
                    <td><input id="userName" type="text" name="userName" onkeyup="validateLoginForm();" /></td>
                </tr>

                <tr>
                    <td><label for="userPassword" style="font-weight: bold;">Password</label></td>
                    <td><input id="userPassword" type="password" name="userPassword" onkeyup="validateLoginForm();" />
                    </td>
                </tr>

                <tr id="saveFingerprint" style="display:none">
                    <td><label for="saveData" style="font-weight: bold;">Anmeldedaten speichern</label></td>
                    <td><input id="saveData" type="checkbox" name="saveData" onchange="onSaveDataChange();" /></td>
                </tr>
                <!--tr id="useFingerprintTableRow" style="display: none;">
                    <td><label for="useFingerprint" style="font-weight: bold;">Fingerprint / TouchID</label></td>
                    <td><input id="useFingerprint" type="checkbox" name="useFingerprint" /></td>
                </tr-->
                <tr>
                    <td colspan="2" align="center">
                        <input type="button" value="Login" id="loginButton" disabled="disabled"
                            style='background-color: lightgreen;' onclick="startLogin();" />
                    </td>
                </tr>

                <tr>
                    <td colspan="2" align="center">
                        <input type="button" value="Benutzerdaten lÃ¶schen" id="changeUserContextButton"
                            style='display: none; background-color: lightblue; margin-top: 25px;'
                            onclick="deleteCurrentSavedUserContext();" />
                    </td>
                </tr>
            </tbody>
        </table>
    </form>

    <script type="text/javascript">
        window.document.loginForm.reloginUrl.value = location.href;
    </script>
</body>

</html>